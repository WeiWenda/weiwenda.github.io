---
layout: post
category:
tags: []
---
本文只陈述Spark2.x Scheduler的宏观架构，不涉及具体代码，希望能够帮助读者加深对广义调度系统的理解。

陈述一、首先我们将调度系统抽象出来：
1. 有人或者机器时不时地向调度系统提交作业，因此调度系统需要有作业队列
2. 调度系统必须持有和管理作业运行所需资源，因此调度系统需要有资源列表
3. 调度系统必须对作业运行结果负责，因此调度系统中的每个作业必须有状态，在失败的时候要能够重新执行
4. 调度的终极目标是将资源尽快或尽可能公平地将分配给最需要它的作业，这也是信息产业一部分企业在做的事，滴滴、外卖、12306。

PS: 我想如果人们对衣、食、住不挑的话，用调度系统也许比购买系统资源利用率会更高，比如战时物资。假如医疗、教育用公平调度完成的话，也不会有那么多社会问题，可惜资源太少只能允许玩家氪金。人活着就需要占用社会资源，只不过穷人富人的优先级不同。

陈述二、spark真正意义上的Scheduler只有一个，就是TaskScheduler。不妏将DAGScheduler视为TaskSet产生器，将SchedulerBackend视为executor注册表，将TaskSetManager视为TaskSet运行状态管理器。TaskScheduler的作用就是将这三个组件组装起来完成计算任务。

陈述三、spark真正意义上的调度行为只有一个，就是SchedulerBackend的reviveThread线程，这是一个循环线程，每秒都在尝试把executor分配出去。